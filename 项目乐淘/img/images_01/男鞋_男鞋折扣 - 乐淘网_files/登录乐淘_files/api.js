XN.Type.createNamespace("XN");XN.$create_ApiErrorResult=function XN_ApiErrorResult(){return{}};XN.$create_ApiErrorRequestArg=function XN_ApiErrorRequestArg(){return{}};XN.ApiErrorCode=XN.Type.createEnum({unknown_error:1,service_not_available:2,unknown_method:3,max_requests_reached:4,remote_address_not_allowed:5,session_key_expired_old:6,call_count_over_limit:7,invalid_parameter:100,invalid_api_key:101,invalid_session_key:102,post_required:103,invalid_signature:104,invalid_token:105,permission_denied:200,permission_user:210,permission_album:220,permission_photo:221,session_key_expired:450,session_key_not_allowed:451,session_key_format_error:452,session_key_not_optional:453,lack_of_api_key:10201,lack_of_session_key:10202,lack_of_call_id:10203,login_failed:10000,auth_token_unavailable:2000,no_userid_in_token:2001,user_not_logged_in:2002,status_too_fastorsame:10400,status_too_long:10401,status_illegal:10402,user_quota_exceeded:10600,invalid_feed_template:10601,empty_feed_text:10602,target_token_required:10603,title_data_not_json:10604,feed_title_lack_of_parameters:10605,invalid_xnml_in_feed:10606,feed_body_too_long:10607,feed_photo_link_error:10608,invalid_xnml_in_feed_title:10609,invalid_xnml_in_feed_body:10610,call_too_frequent:10611,cache_error:10612,message_token_not_allowed:10613,feed_title_required:10614,feed_title_lack_of_parameters2:10615,feed_title_token_data_not_match:10616,feed_template_not_registered:10617,url_err:10618,body_data_not_json:10619,invalid_xnml_in_feed_body2:10620,received_message_data_error:10700,received_uid_error:10701,sender_quota_exceeded:10702,app2user_quota_exceeded:10703,notification_too_frequent:10704,order_id_invalidated:10800,invalid_order_id:10801,invalid_amount_of_money:10802,payment_api_not_authorized:10803,no_such_order_id:10804,ext_perm_status_update:20201,ext_perm_publish_stream:20203,ext_perm_read_stream:20204,ext_perm_publish_feed:20213},false);XN.SequencerBase=XN.Type.createClass({ctor:function(){},instance:{_completedCallback:null,isParallel:true,_api:null}});XN.BatchSequencer=XN.Type.createClass({base:XN.SequencerBase,ctor:function(){this.stepsList=[];XN.BatchSequencer.constructBase(this)},instance:{execute:function(b){this._completedCallback=b;var d=this.stepsList.length;if(d>1){var g={};var f=[];var e=new XN.ArrayEnumerator(this.stepsList);while(e.moveNext()){var c=e.get_current();XN.Sys.add(f,c.jsonRequest._requestBody)}g.method_feed=f;g.serial_only=!this.isParallel;var a=this._api._generateJsonRequest("batch.run",g);a.callback=XN.Delegate.create(this,function(h,i){if(!i&&(i=this._api._checkError(h))){h=null}this._setStepResults$1(h,i);this.onAllCompleted()});a.sendRequest()}else{if(d===1){var c=this.stepsList[0];c.jsonRequest.callback=XN.Delegate.create(this,function(h,i){c.result.setPendingResult(h,i);this.onAllCompleted()});c.jsonRequest.sendRequest()}else{this.onAllCompleted()}}},_setStepResults$1:function(h,e){var b=h;XN.Debug.assert(!b||b.length===this.stepsList.length,"Malformed batch result");var f=this.stepsList.length;for(var d=0;d<f;d++){var a=(this.stepsList[d]).result;if(e){a.exception=e;a.result=null}else{if(b){var g=b[d];var c=XNIntern.JSON.deserialize(g,true);a.setPendingResult(c,null)}}}},onAllCompleted:function(){XN.Sys.clear(this.stepsList);if(this._completedCallback){var a=this._completedCallback;this._completedCallback=null;a()}},_addStep:function(b,a){var c=XN.$create__stepInfo(b,a);XN.Sys.add(this.stepsList,c)}}});XN.ImmediateSequencer=XN.Type.createClass({base:XN.BatchSequencer,ctor:function(a){XN.ImmediateSequencer.constructBase(this);this.isParallel=false;this._callback$2=a},instance:{_addStep:function(b,a){this.pendingResult=a;XN.ImmediateSequencer.callBase(this,"_addStep",[b,a]);this.execute(null)},onAllCompleted:function(){XN.Sys.clear(this.stepsList);if(this._callback$2){this._callback$2(this.pendingResult.result,this.pendingResult.exception)}},pendingResult:null,_callback$2:null}});XN.$create__stepInfo=function XN__stepInfo(b,a){var c={};c.jsonRequest=b;c.result=a;return c};XN.Type.createNamespace("XNIntern");XNIntern.Md5=function XNIntern_Md5(){};XNIntern.Md5.computeHashToString=function XNIntern_Md5$computeHashToString(s){function L(b,a){return(b<<a)|(b>>>(32-a))}function K(k,b){var F,a,d,x,c;d=(k&2147483648);x=(b&2147483648);F=(k&1073741824);a=(b&1073741824);c=(k&1073741823)+(b&1073741823);if(F&a){return(c^2147483648^d^x)}if(F|a){if(c&1073741824){return(c^3221225472^d^x)}else{return(c^1073741824^d^x)}}else{return(c^d^x)}}function r(a,c,b){return(a&c)|((~a)&b)}function q(a,c,b){return(a&b)|(c&(~b))}function p(a,c,b){return(a^c^b)}function n(a,c,b){return(c^(a|(~b)))}function u(G,F,aa,Z,k,H,I){G=K(G,K(K(r(F,aa,Z),k),I));return K(L(G,H),F)}function f(G,F,aa,Z,k,H,I){G=K(G,K(K(q(F,aa,Z),k),I));return K(L(G,H),F)}function D(G,F,aa,Z,k,H,I){G=K(G,K(K(p(F,aa,Z),k),I));return K(L(G,H),F)}function t(G,F,aa,Z,k,H,I){G=K(G,K(K(n(F,aa,Z),k),I));return K(L(G,H),F)}function e(k){var G;var d=k.length;var c=d+8;var b=(c-(c%64))/64;var F=(b+1)*16;var H=Array(F-1);var a=0;var x=0;while(x<d){G=(x-(x%4))/4;a=(x%4)*8;H[G]=(H[G]|(k.charCodeAt(x)<<a));x++}G=(x-(x%4))/4;a=(x%4)*8;H[G]=H[G]|(128<<a);H[F-2]=d<<3;H[F-1]=d>>>29;return H}function B(c){var b="",d="",k,a;for(a=0;a<=3;a++){k=(c>>>(a*8))&255;d="0"+k.toString(16);b=b+d.substr(d.length-2,2)}return b}function J(b){b=b.replace(/\r\n/g,"\n");var a="";for(var k=0;k<b.length;k++){var d=b.charCodeAt(k);if(d<128){a+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128)}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128)}}}return a}var C=Array();var P,h,E,v,g,Y,X,W,V;var S=7,Q=12,N=17,M=22;var A=5,z=9,y=14,w=20;var o=4,m=11,l=16,j=23;var U=6,T=10,R=15,O=21;s=J(s);C=e(s);Y=1732584193;X=4023233417;W=2562383102;V=271733878;for(P=0;P<C.length;P+=16){h=Y;E=X;v=W;g=V;Y=u(Y,X,W,V,C[P+0],S,3614090360);V=u(V,Y,X,W,C[P+1],Q,3905402710);W=u(W,V,Y,X,C[P+2],N,606105819);X=u(X,W,V,Y,C[P+3],M,3250441966);Y=u(Y,X,W,V,C[P+4],S,4118548399);V=u(V,Y,X,W,C[P+5],Q,1200080426);W=u(W,V,Y,X,C[P+6],N,2821735955);X=u(X,W,V,Y,C[P+7],M,4249261313);Y=u(Y,X,W,V,C[P+8],S,1770035416);V=u(V,Y,X,W,C[P+9],Q,2336552879);W=u(W,V,Y,X,C[P+10],N,4294925233);X=u(X,W,V,Y,C[P+11],M,2304563134);Y=u(Y,X,W,V,C[P+12],S,1804603682);V=u(V,Y,X,W,C[P+13],Q,4254626195);W=u(W,V,Y,X,C[P+14],N,2792965006);X=u(X,W,V,Y,C[P+15],M,1236535329);Y=f(Y,X,W,V,C[P+1],A,4129170786);V=f(V,Y,X,W,C[P+6],z,3225465664);W=f(W,V,Y,X,C[P+11],y,643717713);X=f(X,W,V,Y,C[P+0],w,3921069994);Y=f(Y,X,W,V,C[P+5],A,3593408605);V=f(V,Y,X,W,C[P+10],z,38016083);W=f(W,V,Y,X,C[P+15],y,3634488961);X=f(X,W,V,Y,C[P+4],w,3889429448);Y=f(Y,X,W,V,C[P+9],A,568446438);V=f(V,Y,X,W,C[P+14],z,3275163606);W=f(W,V,Y,X,C[P+3],y,4107603335);X=f(X,W,V,Y,C[P+8],w,1163531501);Y=f(Y,X,W,V,C[P+13],A,2850285829);V=f(V,Y,X,W,C[P+2],z,4243563512);W=f(W,V,Y,X,C[P+7],y,1735328473);X=f(X,W,V,Y,C[P+12],w,2368359562);Y=D(Y,X,W,V,C[P+5],o,4294588738);V=D(V,Y,X,W,C[P+8],m,2272392833);W=D(W,V,Y,X,C[P+11],l,1839030562);X=D(X,W,V,Y,C[P+14],j,4259657740);Y=D(Y,X,W,V,C[P+1],o,2763975236);V=D(V,Y,X,W,C[P+4],m,1272893353);W=D(W,V,Y,X,C[P+7],l,4139469664);X=D(X,W,V,Y,C[P+10],j,3200236656);Y=D(Y,X,W,V,C[P+13],o,681279174);V=D(V,Y,X,W,C[P+0],m,3936430074);W=D(W,V,Y,X,C[P+3],l,3572445317);X=D(X,W,V,Y,C[P+6],j,76029189);Y=D(Y,X,W,V,C[P+9],o,3654602809);V=D(V,Y,X,W,C[P+12],m,3873151461);W=D(W,V,Y,X,C[P+15],l,530742520);X=D(X,W,V,Y,C[P+2],j,3299628645);Y=t(Y,X,W,V,C[P+0],U,4096336452);V=t(V,Y,X,W,C[P+7],T,1126891415);W=t(W,V,Y,X,C[P+14],R,2878612391);X=t(X,W,V,Y,C[P+5],O,4237533241);Y=t(Y,X,W,V,C[P+12],U,1700485571);V=t(V,Y,X,W,C[P+3],T,2399980690);W=t(W,V,Y,X,C[P+10],R,4293915773);X=t(X,W,V,Y,C[P+1],O,2240044497);Y=t(Y,X,W,V,C[P+8],U,1873313359);V=t(V,Y,X,W,C[P+15],T,4264355552);W=t(W,V,Y,X,C[P+6],R,2734768916);X=t(X,W,V,Y,C[P+13],O,1309151649);Y=t(Y,X,W,V,C[P+4],U,4149444226);V=t(V,Y,X,W,C[P+11],T,3174756917);W=t(W,V,Y,X,C[P+2],R,718787259);X=t(X,W,V,Y,C[P+9],O,3951481745);Y=K(Y,h);X=K(X,E);W=K(W,v);V=K(V,g)}var i=B(Y)+B(X)+B(W)+B(V);return i.toLowerCase()};XN.Type.extend(XN.ApiClient.prototype,{_generateJsonRequest:function(a,m){if(!m){m={}}var n=m;for(var g in n){var k={key:g,value:n[g]};var l=typeof(k.value);if(l==="boolean"){m[k.key]=(m[k.key])?1:0}else{if(l==="object"){m[k.key]=XNIntern.JSON.serialize(k.value)}}}m.method=a;m.api_key=this._apiKey;m.format="JSON";var e=(new Date()).getTime();if(e<=this._lastCallId){e=this._lastCallId+1}this._lastCallId=e;m.call_id=e;if(!m.v){m.v=XN.Main.version}if(this._session){XN.Debug.writeLine("session key = "+this._session.session_key);m.session_key=this._session.session_key}if(XN.Main.appSecret){m.sig=this._generateSignature(m,XN.Main.appSecret)}else{if(this._session&&this._session.secret){m.xn_ss=1;m.sig=this._generateSignature(m,this._session.secret)}}var d=new XN.StringBuilder();var j=m;for(var f in j){var k={key:f,value:j[f]};if(!d.get_isEmpty()){d.append("&")}d.append(k.key+"="+encodeURIComponent(k.value.toString()))}var i=this._serverAddress;var c=d.toString();var b={};b["Content-Type"]="application/x-www-form-urlencoded";var h=new XN._xdJsonRequest(this.getXdHttpClient(),"POST",i,c,b);return h},_generateSignature:function(d,a){var f=new XN.StringBuilder();var g=this._convertDictKeysToList(d);g.sort();var c=new XN.ArrayEnumerator(g);while(c.moveNext()){var b=c.get_current();f.append(b+"="+d[b])}f.append(a);var e=XN.Sys.trim(XNIntern.Md5.computeHashToString(f.toString()));return e},_convertDictKeysToList:function(e){var d=[];var b=e;for(var a in b){var c={key:a,value:b[a]};XN.Sys.add(d,c.key)}return d},_checkError:function(a){var b=a;if(!XN.Sys.isUndefined(b.error_code)){if(b.error_code===XN.ApiErrorCode.invalid_session_key||b.error_code===XN.ApiErrorCode.session_key_expired||b.error_code===XN.ApiErrorCode.session_key_format_error){XN.Debug.logLine(1,"Bad session key, clear it");this.set_session(null)}return XNIntern.Utility.createException(b.error_msg,b)}return null},connect_getUnconnectedFriendsCount:function(a){return this.callMethod("connect.getUnconnectedFriendsCount",null,a)},feed_publishUserAction:function(h,e,b,d,c,f,a){var g={};g.template_bundle_id=h.toString();if(e){g.template_data=e}if(b){g.target_ids=b.toString()}if(d){g.body_general=d}if(c>0){g.story_size=c}if(f){g.user_message=f}return this.callMethod("feed.publishUserAction",g,a)},feed_publishTemplatizedAction:function(b,c,d,a){var e={};e.template_id=b.toString();if(c){e.title_data=c}if(d){e.body_data=d}return this.callMethod("feed.publishTemplatizedAction",e,a)},feed_publish:function(b,c,e,h,g,d,a){var f={};f.template_id=b.toString();f.title_data=c;f.body_data=e;if(h){f.attachment=h}if(g){f.desc=g}if(typeof(d)=="function"){a=d}else{if(d){f.action_links=d}}return this.callMethod("feed.publish",f,a)},feed_getFeedList:function(c,e,b,a){var d={};if(c){d.type=c}if(e){d.offset=e}else{d.offset=0}if(b){d.limit=b}else{d.limit=10}return this.callMethod("feed.getFeedList",d,a)},friends_get:function(a){return this.callMethod("friends.get",null,a)},friends_getFriends:function(e,d,b,a){var c={};c.page=e||1;c.count=d||500;if(b){c.fields=b.toString()}return this.callMethod("friends.getFriends",c,a)},friends_areFriends:function(c,b,a){var d={};d.uids1=c.toString();d.uids2=b.toString();return this.callMethod("friends.areFriends",d,a)},friends_getAppUsers:function(a){return this.callMethod("friends.getAppUsers",null,a)},friends_getAppFriends:function(b,a){var c={};if(b){c.fields=b.toString()}return this.callMethod("friends.getAppFriends",c,a)},notifications_send:function(d,c,a){var b={};b.to_ids=d.toString();b.notification=c;return this.callMethod("notifications.send",b,a)},notifications_sendEmail:function(b,c,a){var d={};d.recipients=b.toString();d.template_id=c.toString();return this.callMethod("notifications.sendEmail",d,a)},users_getInfo:function(d,b,a){var c={};c.uids=d.toString();c.fields=b.toString();return this.callMethod("users.getInfo",c,a)},users_getLoggedInUser:function(a){var b={};return this.callMethod("users.getLoggedInUser",b,a)},users_hasAppPermission:function(b,a){var c={};c.ext_perm=b;return this.callMethod("users.hasAppPermission",c,a)},users_isAppAdded:function(a){var b={};return this.callMethod("users.isAppAdded",b,a)},profile_setXNML:function(b,c,a){var d={};if(b){d.uid=b}d.profile=c;return this.callMethod("profile.setXNML",d,a)},blog_addComment:function(g,b,f,d,c,a){var e={};e.id=g;e.content=f;e.uid=b;if(d){e.type=d}if(c){e.rid=c}return this.callMethod("blog.addComment",e,a)},blog_getComments:function(f,b,e,d,a){var c={};c.id=f;if(b){c.uid=b}if(e){c.page=e}if(d){c.count=d}return this.callMethod("blog.getComments",c,a)},photos_getComments:function(c,b,a){var d={};d.uid=c;d.pid=b;return this.callMethod("photos.getComments",d,a)},photos_addComment:function(c,b,g,e,d,a){var f={};f.pid=b;f.uid=c;f.content=g;if(e){f.rid=e}if(d){f.type=d}return this.callMethod("photos.addComment",f,a)},photos_get:function(b,d,a){var c={};c.uid=b;if(d){c.pids=d}return this.callMethod("photos.get",c,a)},profile_getXNML:function(b,a){var c={};c.uid=b;return this.callMethod("profile.getXNML",c,a)},connect_getStatusFeeds:function(d,c,a){var b={};if(d){b.page=d}if(c){b.count=c}return this.callMethod("connect.getStatusFeeds",b,a)},connect_getEvents:function(a){var b={};return this.callMethod("connect.getEvents",b,a)},status_set:function(c,b,d,a){var e={};e.status=c;if(typeof(b)=="number"&&typeof(d)=="number"){e.forward_id=b;e.forward_owner=d}else{a=b}return this.callMethod("status.set",e,a)},status_getComment:function(d,c,b,a){var e={};e.status_id=d;e.owner_id=c;e.limit=b;return this.callMethod("status.getComment",e,a)},status_getEmoticons:function(b,a){var c={};c.type=b?b:"recent";return this.callMethod("status.getEmoticons",c,a)},status_gets:function(b,e,d,a){var c={};if(b){c.uid=b}if(e){c.page=e}if(d){c.count=d}return this.callMethod("status.gets",c,a)},status_addComment:function(d,c,f,b,a){var e={};e.status_id=d;e.owner_id=c;e.content=f;if(b){e.replyId=b}return this.callMethod("status.addComment",e,a)},callMethod:function(g,c,d){XN.Debug.logLine(2,"callMethod: method = "+g);if(XN.Debug.logLevel>2){XN.Debug.dump(c,"callMethod: parameters")}var f=!this._session&&!XN.Main.appSecret;var b=this._generateJsonRequest(g,c);if(typeof(d)!=="function"){var a=new XN.PendingResult();if(!f){d._api=this;d._addStep(b,a)}else{a.setPendingResult(null,XNIntern.Utility.createException("Invalid session state",XN.ApiErrorCode.invalid_session_key))}return a}else{var e=(d);if(!f){b.callback=XN.Delegate.create(this,function(h,i){if(!i&&(i=this._checkError(h))){h=null}e(h,i)});b.sendRequest()}else{e(null,XNIntern.Utility.createException("Invalid session state",XN.ApiErrorCode.invalid_session_key))}return null}}});XN.XdHttpRequestServer=XN.Type.createClass({ctor:function(){},static_ctor:function(){XN.XdHttpRequestServer._rootUrl=null;XN.XdHttpRequestServer._allowedUrlFilter=null;XN.XdHttpRequestServer._allowedUrls=null},statics:{main:function(b){var d=b.receiver;if(XN.Sys.containsKey(b,"allowed_url_filter")){XN.XdHttpRequestServer._allowedUrlFilter=new RegExp(b.allowed_url_filter)}if(XN.Sys.containsKey(b,"allowed_urls")){XN.XdHttpRequestServer._allowedUrls=b.allowed_urls}var c=new XNIntern.Uri(document.URL);XN.XdHttpRequestServer._rootUrl=c.get_schemeAndDomain();var a=c.get_queryParameters()["debug_level"];if(a){var e=parseInt(a);if(e>XN.Debug.logLevel){XN.Debug.logLevel=e}}XN.XdComm.Server.singleton.set_receiverUrl(d);XN.XdComm.Server.singleton.registerDataHandler("http_server",XN.XdHttpRequestServer._onDataReceived)},_isUrlAllowed:function(b){if(XN.XdHttpRequestServer._allowedUrlFilter&&XN.XdHttpRequestServer._allowedUrlFilter.test(b)){return true}if(XN.XdHttpRequestServer._allowedUrls){var c=new XN.ArrayEnumerator(XN.XdHttpRequestServer._allowedUrls);while(c.moveNext()){var a=c.get_current();if(a===b){return true}}}return false},_onDataReceived:function(d,e){var g=d;var c=XNIntern.Utility.createXMLHttpRequest();var a=g[2];if(!XN.XdHttpRequestServer._isUrlAllowed(a)){XN.Debug.assert(false,"URL "+a+" is not allowed.");return}a=XN.XdHttpRequestServer._rootUrl+a;XN.Debug.logLine(3,"XdHttpRequestServer: make XHR request to "+a);c.onreadystatechange=function(){if(c.readyState===4){var j=XN.$create_XdHttpRequestResult(g[0],c.status,c.statusText,c.responseText);XN.Debug.logLine(3,"XdHttpRequestServer: send result back http_client");XN.XdComm.Server.singleton.send(e,"http_client",j)}};c.open(g[1],g[2],true);var b=g[4];if(b){var i=b;for(var h in i){var f={key:h,value:i[h]};c.setRequestHeader(f.key,f.value.toString())}}c.send(g[3])}}});XN.FeatureLoader.onScriptLoaded(["Api"]);